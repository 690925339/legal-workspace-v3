# AI法律助手 - 产品需求文档 (PRD)

## 📋 文档信息

**产品名称**: AI法律助手 - Legal Workspace  
**版本**: v3.2  
**文档类型**: 产品需求文档 (Product Requirements Document)  
**最后更新**: 2025-12-09  
**文档状态**: 正式版

---

## 目录

1. [产品概述](#产品概述)
2. [核心功能需求](#核心功能需求)
3. [数据模型与字段定义](#数据模型与字段定义)
4. [UI/UX设计规范](#uiux设计规范)
5. [技术架构](#技术架构)
6. [开发计划](#开发计划)

---

## 产品概述

### 产品定位
AI法律助手是一个现代化、智能化的法律案件管理系统，为律师和法务人员提供全方位的案件管理和AI辅助功能。

### 目标用户
- 律师事务所律师
- 企业法务人员
- 法律服务机构

### 核心价值
- **效率提升**: 自动化案件信息管理，减少重复劳动
- **智能辅助**: AI驱动的分析和建议，提升决策质量
- **数据可视化**: 直观展示案件关系和时间线
- **知识管理**: 法律研究和案例检索一体化

---

## 核心功能需求

### 1. 用户认证与管理

#### 1.1 用户登录
**功能描述**: 用户通过邮箱/用户名和密码登录系统

**交互流程**:
1. 用户输入邮箱/用户名和密码
2. 点击"登录"按钮提交
3. 系统验证凭据
4. 登录成功后跳转到工作台

**UI元素**:
- 居中的登录卡片
- 输入框带图标提示
- "记住我"复选框
- "忘记密码"链接
- 主色调登录按钮

**验证规则**:
- 邮箱格式验证
- 密码长度验证（最小6位）

**技术实现**:
- 使用 Supabase Authentication 服务
- 全局认证状态管理 (`authStore.js`)
- `onAuthStateChange` 监听认证事件
- 自动重定向未认证用户到登录页

**状态**: ✅ 已实现

#### 1.1.1 忘记密码
**功能描述**: 用户可以通过邮箱收取密码重置链接

**交互流程**:
1. 点击登录页"忘记密码？"链接
2. 输入注册邮箱
3. 点击"发送重置链接"
4. 系统发送密码重置邮件
5. 显示成功提示

**UI元素**:
- 居中的表单卡片
- 邮箱输入框
- 发送按钮（带加载状态）
- 成功/错误提示
- 返回登录链接

**技术实现**:
- 调用 `authService.resetPassword(email)`
- Supabase 发送重置邮件

**状态**: ✅ 已实现

#### 1.1.2 用户登出
**功能描述**: 用户可以安全登出系统

**入口位置**: 侧边栏用户菜单 > "退出登录"

**交互流程**:
1. 点击侧边栏底部用户头像
2. 在弹出菜单中点击"退出登录"(红色文字)
3. 系统清除认证状态
4. 自动跳转到登录页

**技术实现**:
- 调用 `authService.signOut()`
- `onAuthStateChange` 监听 `SIGNED_OUT` 事件
- 自动跳转到 `/login`

**状态**: ✅ 已实现

#### 1.2 个人资料管理
**功能描述**: 用户可以查看和编辑个人信息

**可编辑字段**:
- 基本信息: 姓名、职位、邮箱、手机号码、所属部门、办公地点、个人简介
- 账号安全: 当前密码、新密码、确认新密码
- 偏好设置: 邮件通知、短信通知、语言、主题

**交互流程**:
1. 左侧显示个人资料卡片（头像、姓名、职位）
2. 右侧分标签页展示不同设置
3. 点击"编辑"按钮进入编辑模式
4. 修改后点击"保存"提交更改
5. 显示成功提示Toast

**UI元素**:
- 左侧固定宽度资料卡片（300px）
- 右侧自适应内容区域
- 标签页切换导航
- 头像悬停显示"更换头像"
- 成功提示Toast（右上角，绿色背景）

**状态**: ✅ 已实现

---

### 2. 案件管理

#### 2.1 案件列表

##### 2.1.1 案件列表展示
**功能描述**: 以表格形式展示所有案件

**显示字段**:
- 案件名称（主标题）
- 案件编号
- 客户名称
- 案件类型
- 状态标签（进行中、草稿、已结案、未签约）
- 负责人（头像标识）
- 最后更新时间

**交互方式**:
- 滚动查看所有案件
- 点击案件行跳转到案件详情页
- 悬停行高亮显示

**UI元素**:
- 响应式表格
- 状态标签颜色编码:
  - 进行中: 蓝色
  - 草稿: 灰色
  - 已结案: 绿色
- 负责人头像圆形显示
- 操作按钮: 查看、编辑、结案（仅进行中）、删除

**状态**: ✅ 已实现

##### 2.1.2 案件搜索
**功能描述**: 实时搜索案件

**搜索范围**:
- 案件名称
- 案件编号
- 客户名称

**交互方式**:
- 在搜索框输入关键词
- 实时过滤显示匹配结果
- 清空搜索框恢复全部显示

**UI元素**:
- 顶部搜索栏（带搜索图标）
- 占位符提示文字: "搜索案件名称、编号或客户..."

**状态**: ✅ 已实现

##### 2.1.3 新建案件
**功能描述**: 通过模态框表单创建新案件

**交互流程**:
1. 点击"新建案件"按钮打开模态框
2. 填写5个部分的案件信息
3. 点击"保存"存为草稿状态
4. 点击"提交"设为进行中状态

**底部按钮**:
- 取消: 关闭模态框
- 保存: 保存为草稿状态
- 提交: 保存为进行中状态

**UI元素**:
- 全屏模态框
- 分区卡片布局
- 表单网格布局（2列）
- 底部操作按钮栏

**状态**: ✅ 已实现

##### 2.1.4 结案操作
**功能描述**: 将进行中的案件标记为已结案

**入口位置**: 案件列表操作栏（红色文件夹图标）

**交互流程**:
1. 点击结案图标（仅进行中案件显示）
2. 系统弹出确认对话框
3. 确认后案件状态变为"已结案"
4. 已结案案件只读，不可修改

**状态**: ✅ 已实现

#### 2.2 案件表单（新建/编辑）

##### 2.2.1 基础信息
**可编辑字段**:

| 字段名称 | 字段类型 | 是否必填 | 说明 |
|---------|---------|---------|------|
| 案件名称 | 文本 | 是 | 案件的标题描述 |
| 案件编号 | 文本 | 否 | 系统或手动编号 |
| 案由 | 下拉选择 | 否 | 民事、刑事、行政 |
| 具体案由 | 文本 | 否 | 三级案由详细描述 |
| 案件阶段 | 下拉选择 | 否 | 咨询、立案、一审、二审等 |
| 管辖法院/仲裁委 | 文本 | 否 | 管辖机构名称 |
| 承办法官 | 文本 | 否 | 法官姓名 |
| 立案日期 | 日期选择器 | 否 | 可选字段 |
| 诉讼时效/上诉截止日 | 日期选择器 | 否 | 重要时间节点 |

**UI元素**:
- 卡片标题带图标（fa-info-circle）
- 灰色背景标题栏
- 网格布局表单（2列）

**状态**: ✅ 已实现

##### 2.2.2 当事人信息
**功能描述**: 支持添加多个原告和被告

**原告字段**:

| 字段名称 | 字段类型 | 是否必填 | 说明 |
|---------|---------|---------|------|
| 姓名/名称 | 文本 | 是 | 当事人姓名或公司名称 |
| 主体类型 | 下拉选择 | 是 | 个人、公司 |
| 身份证号/统一信用代码 | 文本 | 否 | 根据主体类型显示 |

**被告字段**:

| 字段名称 | 字段类型 | 是否必填 | 说明 |
|---------|---------|---------|------|
| 姓名/名称 | 文本 | 是 | 当事人姓名或公司名称 |
| 主体类型 | 下拉选择 | 是 | 个人、公司 |
| 法定代表人 | 文本 | 否 | 公司法定代表人 |
| 对方代理律师 | 文本 | 否 | 对方律师信息 |

**交互方式**:
- 点击"添加原告"/"添加被告"按钮新增当事人
- 点击"移除"按钮删除当事人（至少保留一个）
- 每个当事人独立填写信息

**UI元素**:
- 动态表单项（v-for循环）
- 添加/移除按钮
- 分隔线区分不同当事人

**状态**: ✅ 已实现

##### 2.2.3 案情描述
**可编辑字段**:

| 字段名称 | 字段类型 | 是否必填 | 说明 |
|---------|---------|---------|------|
| 案情摘要 | 多行文本 | 否 | 案件基本情况描述（4行，带边框） |
| 争议焦点 | 文本 | 否 | 逗号分隔的争议点 |
| 客户诉求 | 多行文本 | 否 | 客户的诉讼目标（2行，带边框） |

**UI元素**:
- 卡片标题带图标（fa-file-text）
- 全宽度文本框
- 文本框带边框（1px solid #ccc）

**状态**: ✅ 已实现

##### 2.2.4 财务信息
**可编辑字段**:

| 字段名称 | 字段类型 | 是否必填 | 说明 |
|---------|---------|---------|------|
| 诉讼标的额 | 数字 | 否 | CNY金额 |
| 律师费报价 | 数字 | 否 | CNY金额 |
| 预估诉讼费 | 数字 | 否 | CNY金额 |
| 计费时长 | 数字 | 否 | 小时数 |

**UI元素**:
- 卡片标题带图标（fa-calculator）
- 网格布局（2列）
- 数字输入框

**状态**: ✅ 已实现

##### 2.2.5 联络人信息
**可编辑字段**:

| 字段名称 | 字段类型 | 是否必填 | 说明 |
|---------|---------|---------|------|
| 姓名 | 文本 | 否 | 联络人姓名 |
| 职位/角色 | 文本 | 否 | 职位或角色描述 |
| 电话 | 文本 | 否 | 联系电话 |
| 邮箱 | 邮箱 | 否 | 电子邮箱地址 |
| 地址 | 文本 | 否 | 联系地址 |

**UI元素**:
- 卡片标题带图标（fa-address-book）
- 网格布局（2列）
- 地址字段占满宽

**状态**: ✅ 已实现

##### 2.2.6 表单操作
**交互方式**:
- 点击"取消"关闭模态框
- 点击"保存"（带fa-save图标）提交表单
- 点击"保存并新建"（仅新建时）保存后重置表单

**验证规则**:
- 案件名称必填
- 至少一个原告和一个被告

**状态**: ✅ 已实现

#### 2.3 案件详情页

##### 2.3.1 页面结构
**布局**:
- 顶部: 面包屑导航（案件 > 详情 > [案件编号]）
- 左侧: 标签页导航（固定宽度200px）
- 右侧: 内容区域（自适应）

**标签页分类**:
1. 基础信息
2. 案情描述
3. 当事人信息
4. 证据管理
   - 证据清单
   - 证据分析规划
5. 财务信息
6. 高级功能
   - AI分析
   - AI对话助手
   - 关系洞察
   - 案件时间轴

**交互方式**:
- 点击标签页切换内容
- 当前标签页高亮显示
- 子标签页缩进显示

**状态**: ✅ 已实现

##### 2.3.2 基础信息标签页
**显示内容**:
- 基础信息卡片: 案件标题、编号、案由、法院、日期等
- 联络人卡片: 头像、姓名、职位、联系方式

**交互方式**:
- 点击基础信息卡片右上角"笔"图标打开编辑模态框
- 点击联络人卡片右上角"笔"图标打开联络人编辑模态框

**编辑模态框**:
- 基础信息模态框（宽度: 600px）
  - 字段: 案件名称、案件编号、案由、具体案由、管辖法院、立案日期、案件状态
  - 保存按钮带fa-save图标
- 联络人模态框（宽度: 600px）
  - 字段: 姓名、职位/角色、电话、邮箱、地址
  - 保存按钮带fa-save图标

**状态**: ✅ 已实现

##### 2.3.3 案情描述标签页
**显示内容**:
- 案情摘要（文本段落）
- 争议焦点（标签列表）
- 客户诉求（文本段落）

**交互方式**:
- 点击卡片右上角"笔"图标打开编辑模态框

**编辑模态框**（宽度: 700px）:
- 案情摘要（多行文本框，6行，带边框）
- 争议焦点（多行文本框，4行，带边框）
- 客户诉求（多行文本框，3行，带边框）
- 保存按钮带fa-save图标

**状态**: ✅ 已实现

##### 2.3.4 当事人信息标签页
**显示内容**:
- 原告列表（卡片形式）
- 被告列表（卡片形式）
- 第三人列表（卡片形式）

**每个当事人卡片显示**:
- 主体类型图标（个人: fa-user / 公司: fa-building）
- 姓名/名称
- 身份证号/统一信用代码
- 联系电话（个人）
- 法定代表人（公司）
- 地址
- 对方代理律师（被告）

**交互方式**:
- 点击"添加原告"/"添加被告"/"添加第三人"按钮打开模态框
- 点击当事人卡片右上角"笔"图标编辑
- 点击"删除"图标删除当事人

**编辑模态框**（宽度: 600px）:
- 主体类型（单选：自然人、法人/组织）
- 根据主体类型显示不同字段
- 保存按钮带fa-save图标

**状态**: ✅ 已实现

##### 2.3.5 财务信息标签页
**显示内容**:
- 诉讼标的额（金额 + CNY）
- 律师费报价（金额 + CNY）
- 预估诉讼费（金额 + CNY）
- 计费时长（小时数）

**交互方式**:
- 点击卡片右上角"笔"图标打开编辑模态框

**编辑模态框**（宽度: 600px）:
- 四个财务字段
- 保存按钮带fa-save图标

**状态**: ✅ 已实现

---

### 3. 证据管理

#### 3.1 证据清单

##### 3.1.1 证据列表展示
**功能描述**: 以列表形式展示所有已上传的证据文件

**显示内容**:
- 文件名称
- 文件类型图标（PDF、图片、文档等）
- 文件大小
- 上传时间
- 证据分类标签（颜色编码）
- AI置信度（百分比 + 进度条）

**交互方式**:
- 点击文件名预览文件（规划中）
- 点击分类标签重新分类
- 点击下载图标下载文件（规划中）

**分类标签颜色**:
- 合同协议: 蓝色 (#e0f2fe / #0369a1)
- 支付凭证: 绿色 (#dcfce7 / #15803d)
- 往来函件: 紫色 (#f3e8ff / #7e22ce)
- 其他证据: 灰色 (#f3f4f6 / #4b5563)

**状态**: ✅ 已实现

##### 3.1.2 证据上传
**功能描述**: 支持拖拽或点击上传多个文件

**支持格式**:
- 文档: PDF, Word, Excel
- 图片: JPG, PNG, GIF
- 其他: 录音、视频等

**交互方式**:
- 点击上传区域选择文件
- 拖拽文件到上传区域
- 显示上传进度
- AI自动识别并分类

**UI元素**:
- 虚线边框上传区域
- 上传图标 + 提示文字
- 进度条显示上传状态

**状态**: ✅ 已实现

#### 3.2 AI证据分析规划

##### 3.2.1 证据完整度评估
**显示内容**:
- 完整度百分比（大字体显示）
- 已收集/总数（如: 3/6）
- 已收集证据数量
- 缺失证据数量

**UI元素**:
- 统计卡片（3个并排）
- 图标 + 数值 + 标签

**状态**: ✅ 已实现

##### 3.2.2 证据清单
**显示内容**:
- 证据名称
- 优先级标签（极高、高、中、低）
- 收集状态（✓ 已收集 / ✗ 未收集）
- 证据说明
- 复选框（已收集的自动勾选）

**优先级颜色**:
- 极高: 红色背景 (#dc3545)
- 高: 橙色 (#ff9800)
- 中: 蓝色 (#2196f3)
- 低: 绿色 (#4caf50)

**交互方式**:
- 点击复选框标记证据收集状态
- 按优先级排序显示

**状态**: ✅ 已实现

##### 3.2.3 导出证据清单
**功能描述**: 导出证据分析清单为Excel或PDF

**交互方式**:
1. 点击"导出清单"按钮
2. 选择导出格式（Excel/PDF）
3. 下载文件

**UI元素**:
- 次按钮（smart-btn-secondary）
- 下载图标

**状态**: ✅ 已实现

---

### 4. AI智能功能

#### 4.1 AI智能分析

##### 4.1.1 胜诉率预测
**功能描述**: AI基于案情和证据预测胜诉概率

**显示内容**:
- 胜诉率百分比（超大字体: 48px, font-weight: 700）
- 说明文字"(基于现有证据分析)"
- 可视化进度条（黑色填充，高度: 12px）

**UI元素**:
- 大字体数值显示
- 进度条（灰色背景 + 黑色填充）
- 圆角设计（6px）

**状态**: ✅ 已实现

##### 4.1.2 风险点提示
**功能描述**: 智能识别案件中的风险点

**显示内容**:
- 风险点列表
- 每个风险点包含：
  - 风险图标（fa-exclamation-triangle / fa-info-circle）
  - 风险描述文字
  - 背景颜色区分严重程度

**风险等级**:
- 高风险: 黄色背景 (#fef3c7) + 橙色左边框 (#d97706)
- 一般提示: 灰色背景 (#f5f5f5) + 灰色左边框 (#666)

**状态**: ✅ 已实现

##### 4.1.3 AI策略建议
**功能描述**: 提供诉讼策略和证据收集建议

**显示内容**:
- 策略建议文本段落
- 灰色背景卡片

**UI元素**:
- 灰色背景（#f5f5f5）
- 圆角卡片（6px）
- 行高: 1.8

**状态**: ✅ 已实现

##### 4.1.4 刷新分析
**功能描述**: 重新生成AI分析报告

**交互方式**:
- 点击右上角"刷新分析"按钮
- 重新计算胜诉率和风险点

**UI元素**:
- 次按钮（smart-btn-secondary）
- 刷新图标 + 文字
- 绝对定位右上角（top: 20px, right: 20px）

**状态**: ✅ 已实现

#### 4.2 AI对话助手

##### 4.2.1 聊天界面
**布局**:
- 聊天消息区域（自适应高度: calc(100vh - 180px)）
- 快捷建议区域（仅首次显示）
- 输入区域（固定底部）

**消息显示**:
- AI消息: 左对齐，白色背景，机器人头像（fa-robot）
- 用户消息: 右对齐，黑色背景，用户头像（fa-user）
- 消息气泡: 圆角12px，顶部小角标（2px）
- 头像: 圆形，36px

**UI元素**:
- 灰色背景聊天区域（#fafafa）
- 消息气泡阴影（0 2px 8px rgba(0,0,0,0.05)）
- AI头像背景: 蓝紫色（#e0e7ff / #4f46e5）
- 用户头像背景: 灰色（#f3f4f6 / #666）

**状态**: ✅ 已实现

##### 4.2.2 快捷建议
**功能描述**: 提供常用问题快捷入口

**建议内容**:
- "分析本案的胜诉概率"
- "生成一份证据收集清单"
- "起草一份律师函"
- "查找类似的判决案例"

**交互方式**:
- 点击建议自动发送消息
- 发送后隐藏建议区域

**UI元素**:
- 网格布局（2列）
- 按钮样式（smart-suggestion-item）
- 灯泡图标 + "快捷建议"标题

**状态**: ✅ 已实现

##### 4.2.3 消息输入
**交互方式**:
- 在文本框输入消息
- 按Enter发送
- 按Shift+Enter换行
- 点击"发送"按钮发送

**UI元素**:
- 自适应高度文本框（min: 44px, max: 120px）
- 发送按钮（主按钮，fa-paper-plane图标）
- 底部提示文字: "按 Enter 发送，Shift + Enter 换行"

**状态**: ✅ 已实现

#### 4.3 关系洞察

##### 4.3.1 关系图谱可视化
**功能描述**: 使用D3.js展示人物和公司关系网络

**显示内容**:
- 节点: 人物（圆形）、公司（方形）
- 连线: 关系类型 + 金额（如有）
- 颜色编码: 不同主体类型不同颜色

**交互方式**:
- 拖拽节点改变位置
- 滚轮缩放图谱
- 点击节点查看详情
- 节点之间自动力导向布局

**UI元素**:
- SVG画布（800x600）
- 节点标签
- 连线标签（关系 + 金额）

**状态**: ✅ 已实现

##### 4.3.2 图例和统计
**显示内容**:
- 图例: 节点颜色含义
- 统计信息:
  - 实体总数
  - 关系总数
  - 涉及金额

**UI元素**:
- 右侧固定面板
- 图标 + 数值显示

**状态**: ✅ 已实现

##### 4.3.3 刷新图谱
**功能描述**: 重新布局关系图谱

**交互方式**:
- 点击"刷新图谱"按钮
- 重新计算节点位置

**UI元素**:
- 次按钮（smart-btn-secondary）
- 刷新图标 + 文字

**状态**: ✅ 已实现

#### 4.4 案件时间轴

##### 4.4.1 时间轴展示
**显示内容**:
- 时间线（垂直布局）
- 事件节点（圆点）
- 事件信息: 日期、标题、描述

**事件状态**:
- 已完成: 绿色圆点
- 进行中: 蓝色圆点
- 待开始: 灰色圆点

**UI元素**:
- 垂直时间线
- 左侧圆点 + 右侧内容
- 连接线

**状态**: ✅ 已实现

##### 4.4.2 添加事件
**功能描述**: 手动添加新的案件事件

**交互方式**:
- 点击"添加事件"按钮
- 填写事件信息
- 保存添加到时间轴

**UI元素**:
- 主按钮（smart-btn-primary）
- 加号图标

**状态**: ✅ 已实现

---

### 5. 法律研究

#### 5.1 搜索功能
**功能描述**: 搜索法律法规和案例

**交互流程**:
1. 输入关键词
2. 点击搜索按钮或按Enter
3. 实时显示搜索结果

**UI元素**:
- 大号搜索框
- 搜索图标
- 占位符提示

**状态**: ✅ 已实现

#### 5.2 筛选功能

##### 5.2.1 筛选面板
**功能描述**: 通过多个条件筛选搜索结果

**筛选条件**:

| 筛选项 | 类型 | 选项 |
|-------|------|------|
| 关键词 | 文本输入 | - |
| 法院层级 | 下拉选择 | 最高法、高级法院、中级法院、基层法院 |
| 地区 | 下拉选择 | 全国、北京、上海、广东等 |
| 裁判年份 | 年份范围 | 1980-2024（两个下拉框） |
| 审理程序 | 下拉选择 | 一审、二审、再审、执行 |
| 文书类型 | 下拉选择 | 判决书、裁定书、调解书、决定书 |

**交互方式**:
- 点击"筛选条件"按钮展开/折叠面板
- 选择筛选条件
- 点击"应用筛选"
- 点击"重置"清空条件

**UI元素**:
- 可折叠面板
- 网格布局（3列）
- 下拉选择框

**状态**: ✅ 已实现

#### 5.3 搜索结果

##### 5.3.1 标签页切换
**功能描述**: 在法规和案例之间切换

**交互方式**:
- 点击"法规"或"案例"标签
- 切换显示对应结果

**UI元素**:
- 标签页导航
- 当前标签高亮

**状态**: ✅ 已实现

##### 5.3.2 结果列表
**显示内容**:
- 法规: 法规名称、发布机关、发布日期、效力级别
- 案例: 案件名称、案号、法院、裁判日期、案由

**交互方式**:
- 点击结果项查看详情
- 滚动加载更多

**UI元素**:
- 列表项卡片
- 标题 + 元信息

**状态**: ✅ 已实现

---

## 数据模型与字段定义

### 1. 案件基础信息表 (Case_Meta_Data)
*这是案件的"身份证"，用于快速检索和分类。*

| 字段名称 (Key) | 数据类型 | 字段描述 | AI 应用场景 |
| :--- | :--- | :--- | :--- |
| `case_id` | String (UUID) | 案件唯一标识符 | 系统索引 |
| `case_title` | String | 案件标题（如：张三诉李四民间借贷纠纷） | 标题生成 |
| `case_type` | Enum | 案由（民事-合同、民事-侵权、刑事、行政等） | 决定AI调用哪个领域的法律库 |
| `legal_cause` | String | 具体案由（三级案由，如：机动车交通事故责任纠纷） | 精准判例匹配 |
| `case_stage` | Enum | 案件阶段（咨询、立案、一审、二审、执行、结案） | 流程自动化提醒 |
| `jurisdiction_court` | String | 管辖法院/仲裁委 | 分析该法院过往判决倾向 |
| `judge_name` | String | 承办法官 | 分析法官画像 |
| `filing_date` | Date | 立案日期 | 计算审限 |
| `statute_deadline` | Date | 诉讼时效/上诉截止日 | **高危风险预警** |

---

### 2. 核心事实与案情描述 (Case_Facts_Context)
*这是投喂给AI大模型（LLM）进行理解的核心语料。*

| 字段名称 (Key) | 数据类型 | 字段描述 | AI 应用场景 |
| :--- | :--- | :--- | :--- |
| `client_statement` | Text (Long) | 当事人陈述（原始录音转写或文字记录） | 提取关键事实要素 |
| `fact_summary` | Text | 案情摘要（经过清洗的结构化事实） | 生成起诉状/答辩状的基础 |
| `dispute_focus` | Array[String] | 争议焦点（如：是否构成违约、赔偿金额是否合理） | 针对性法律检索 |
| `timeline_events` | JSON | 时间轴事件（包含：时间、地点、人物、动作） | 自动生成案件大事记图表 |
| `client_objective` | Text | 客户诉求（如：全额退款、赔礼道歉、减刑） | 策略制定的目标导向 |
| `fact_embedding` | Vector | 案情事实的向量化数据 | 用于RAG（检索增强生成）寻找相似案例 |

---

### 3. 当事人与关系方 (Stakeholders)
*AI需要理清人物关系网，用于生成证据链。*

| 字段名称 (Key) | 数据类型 | 字段描述 | AI 应用场景 |
| :--- | :--- | :--- | :--- |
| `party_type` | Enum | 角色（原告/申请人、被告/被申请人、第三人） | 确定文书中的称谓 |
| `is_client` | Boolean | 是否为我方客户 | 决定立场（进攻/防守） |
| `entity_type` | Enum | 主体类型（自然人、法人、非法人组织） | 校验主体资格字段（身份证/统一信用码） |
| `name` | String | 姓名/名称 | 文书自动填充 |
| `legal_rep` | String | 法定代表人 | 文书自动填充 |
| `opposing_counsel` | String | 对方代理律师 | 分析对手风格 |
| `relation_graph` | JSON | 关系图谱（如：A是B的雇主，C是B的配偶） | 利益冲突检索、责任连带分析 |

---

### 4. 证据管理与分析 (Evidence_Matrix)
*法律AI最核心的部分，将证据与证明目的挂钩。*

| 字段名称 (Key) | 数据类型 | 字段描述 | AI 应用场景 |
| :--- | :--- | :--- | :--- |
| `evidence_name` | String | 证据名称（如：微信聊天记录截图） | 证据目录生成 |
| `evidence_type` | Enum | 证据种类（书证、物证、视听资料、电子数据等） | 适用不同的质证规则 |
| `file_path` | String | 文件存储路径 | OCR识别内容 |
| `ocr_content` | Text | 证据内容的文本提取 | 关键词搜索 |
| `proof_purpose` | Text | 证明目的（即该证据想证明什么事实） | 自动生成质证意见 |
| `authenticity_score` | Float | 真实性评分（AI预判） | 风险提示 |
| `relevance_score` | Float | 关联性评分（AI预判） | 剔除无效证据 |
| `legality_check` | Text | 合法性审查意见（如：是否偷录、是否侵权） | 排除非法证据提示 |

---

### 5. 法律研究与AI推理 (AI_Legal_Reasoning)
*这是AI律师软件的"大脑"输出字段。*

| 字段名称 (Key) | 数据类型 | 字段描述 | AI 应用场景 |
| :--- | :--- | :--- | :--- |
| `matched_laws` | JSON | 匹配的法条（法律名称+条文+条款） | 法律依据引用 |
| `similar_cases` | Array[ID] | 相似类案ID（来自裁判文书网数据） | 类案同判参考 |
| `win_probability` | Percentage | 胜诉率预测 | 客户预期管理 |
| `risk_points` | Array[String] | 风险点提示（如：证据不足、时效过期风险） | 案件诊断报告 |
| `strategy_suggestion`| Text | AI建议的诉讼策略 | 律师办案思路辅助 |
| `claim_amount_calc` | JSON | 标的额计算明细（本金、利息、违约金公式） | 自动计算赔偿清单 |

---

### 6. 财务与标的 (Financials)

| 字段名称 (Key) | 数据类型 | 字段描述 |
| :--- | :--- | :--- |
| `claim_amount` | Decimal | 诉讼标的额 |
| `attorney_fee` | Decimal | 律师费报价 |
| `court_cost` | Decimal | 预估诉讼费（根据标的额自动计算） |
| `billable_hours` | Float | 计费时长（关联工作日志） |

---

### 7. 联络人信息 (Contact_Person)

| 字段名称 (Key) | 数据类型 | 字段描述 |
| :--- | :--- | :--- |
| `contact_name` | String | 联络人姓名 |
| `contact_role` | String | 职位/角色 |
| `contact_phone` | String | 联系电话 |
| `contact_email` | String | 电子邮箱 |
| `contact_address` | String | 联系地址 |

---

## UI/UX设计规范

### 颜色系统

#### 主色调
- **主色**: `#1a1a1a` (黑色)
- **次色**: `#666` (深灰)
- **背景**: `#fafafa` (浅灰)
- **边框**: `#e5e5e5` (浅灰)

#### 状态颜色
- **成功**: `#10b981` (绿色)
- **警告**: `#f59e0b` (橙色)
- **危险**: `#dc3545` (红色)
- **信息**: `#2196f3` (蓝色)

#### 案件状态颜色
- **进行中**: 蓝色
- **草稿**: 灰色
- **已结案**: 绿色
- **未签约**: 橙色

### 按钮样式

#### 主按钮 (smart-btn-primary)
- 背景: `#1a1a1a`
- 文字: `#ffffff`
- 圆角: `6px`
- 内边距: `10px 20px`
- 悬停: 背景变为 `#333`

#### 次按钮 (smart-btn-secondary)
- 背景: `#ffffff`
- 边框: `1px solid #1a1a1a`
- 文字: `#1a1a1a`
- 圆角: `6px`
- 内边距: `10px 20px`
- 悬停: 背景变为 `#f5f5f5`

#### 图标按钮 (icon-btn)
- 背景: 透明
- 边框: `1px solid #e5e5e5`
- 圆形: `border-radius: 50%`
- 尺寸: `32px x 32px`
- 悬停: 背景变为 `#f5f5f5`

### 表单元素

#### 输入框 (smart-input)
- 边框: `1px solid #e5e5e5`
- 圆角: `6px`
- 内边距: `10px 12px`
- 字体大小: `14px`
- 聚焦: 边框变为 `#1a1a1a`

#### 下拉框 (smart-select)
- 边框: `1px solid #e5e5e5`
- 圆角: `6px`
- 内边距: `10px 12px`
- 字体大小: `14px`
- 带下拉箭头图标

#### 文本框 (smart-textarea)
- 边框: `1px solid #ccc`
- 圆角: `6px`
- 内边距: `12px`
- 最小高度: `120px`
- 字体大小: `14px`
- 行高: `1.6`

#### 标签 (smart-label)
- 字体大小: `14px`
- 颜色: `#666`
- 字体粗细: `500`
- 必填标记: 红色星号

### 卡片样式

#### 现代卡片 (modern-card)
- 背景: `#ffffff`
- 圆角: `12px`
- 阴影: `0 2px 8px rgba(0,0,0,0.05)`
- 内边距: `20px`

#### 卡片标题 (card-title)
- 字体大小: `16px`
- 字体粗细: `600`
- 颜色: `#1a1a1a`

#### 卡片头部 (card-header)
- 背景: `#fafafa`
- 边框底部: `1px solid #e5e5e5`
- 内边距: `15px 20px`
- Flex布局: `justify-content: space-between`

### 间距规范

- **小间距**: `8px`
- **中间距**: `16px`
- **大间距**: `24px`
- **卡片内边距**: `20px`
- **模态框内边距**: `24px`

### 字体规范

- **标题字体**: `16px - 18px`, 字体粗细 `600`
- **正文字体**: `14px`, 字体粗细 `400`
- **辅助文字**: `13px`, 颜色 `#666`
- **小字**: `12px`, 颜色 `#999`

### 图标规范

- **图标库**: Font Awesome 6
- **图标大小**: `14px - 16px`
- **图标颜色**: 继承父元素或 `#666`

---

## 技术架构

### 前端技术栈
- **框架**: Vue 3 (CDN)
- **路由**: 自定义 Hash 路由
- **样式**: 原生 CSS
- **图标**: Font Awesome 6
- **可视化**: D3.js v7
- **认证**: Supabase Authentication
- **状态管理**: Vue Reactive (`authStore.js`)

### 项目结构
```
legal-workspace-v3/
├── index.html                    # 入口文件
├── assets/
│   └── styles/
│       └── main.css              # 全局样式
├── src/
│   ├── main.js                   # 应用入口、认证初始化
│   ├── router.js                 # 路由配置
│   ├── config/
│   │   └── supabase.js           # Supabase 客户端与认证服务
│   ├── store/
│   │   └── authStore.js          # 全局认证状态管理
│   ├── components/               # 组件
│   │   └── layout/
│   │       ├── AppLayout.js      # 主布局
│   │       └── Sidebar.js        # 侧边栏
│   └── views/                    # 页面视图
│       ├── Dashboard.js          # 工作台
│       ├── CaseList.js           # 案件列表
│       ├── CaseDetail.js         # 案件详情
│       ├── CaseForm.js           # 案件表单
│       ├── LegalResearch.js      # 法律研究
│       ├── UserProfile.js        # 个人资料
│       ├── ProductFeedback.js    # 产品反馈
│       ├── Login.js              # 登录
│       ├── Register.js           # 注册
│       └── ForgotPassword.js     # 忘记密码
└── docs/                         # 文档
```

### 核心组件说明

#### AppLayout.js
- 主应用布局组件
- 包含侧边栏和内容区域
- 响应式布局

#### Sidebar.js
- 侧边栏导航组件
- 可折叠设计
- 用户菜单集成

#### CaseDetail.js
- 案件详情核心页面
- 标签页导航
- 多个子功能模块

---

## 开发计划

### 已完成功能 (v3.0)
- ✅ 用户认证与管理
- ✅ 案件管理（列表、创建、编辑、详情）
- ✅ 分区编辑模态框
- ✅ 多当事人支持
- ✅ 联络人管理
- ✅ 证据管理
- ✅ AI智能分析
- ✅ AI对话助手
- ✅ 关系洞察可视化
- ✅ 案件时间轴
- ✅ 法律研究
- ✅ 个人资料管理
- ✅ 产品反馈

### 近期计划 (v3.1)
- [ ] 文书草拟功能
- [ ] 合同审查功能
- [ ] 文件预览功能
- [ ] 证据下载功能
- [ ] 图谱导出功能

### 中期计划 (v4.0)
- [ ] 团队协作功能
- [ ] 权限管理系统
- [ ] 后端API集成
- [ ] 数据持久化
- [ ] 消息通知系统

### 长期规划
- [ ] 移动端原生应用
- [ ] 多语言支持
- [ ] 私有化部署方案
- [ ] 第三方系统集成
- [ ] 高级数据分析

---

## 附录

### 功能统计
- **已实现功能**: 70+
- **规划中功能**: 25+
- **页面数量**: 8个
- **核心模块**: 5个

### 版本历史

#### v3.2 (2025-12-09)
- 集成 Supabase Authentication 认证服务
- 新增全局认证状态管理 (`authStore.js`)
- 新增忘记密码功能
- 修复登录重定向循环问题
- 实现正确的登出功能
- 简化路由守卫逻辑
- 新增竞品调研报告文档

#### v3.0 (2025-12-04)
- 新增分区编辑模态框
- 新增联络人编辑功能
- 优化AI分析UI
- 增强AI对话助手UI
- 统一保存按钮图标
- 优化文本框边框

#### v2.0 (2025-12-03)
- 重构案件详情页
- 新增多当事人支持
- 新增AI智能分析
- 新增案件时间轴

#### v1.5 (2025-12-02)
- 实现关系洞察可视化
- 优化证据分析界面

---

**文档维护**: 开发团队  
**最后更新**: 2025-12-09  
**文档版本**: v3.2
