# Legal Workspace v3 - æ¶æ„è®¾è®¡æ–‡æ¡£

> **ç‰ˆæœ¬**: v3.3  
> **æœ€åæ›´æ–°**: 2025-12-16  
> **æ–‡æ¡£çŠ¶æ€**: å½“å‰æ¶æ„

## ğŸ“‹ ç›®å½•

- [1. æ¶æ„æ¦‚è§ˆ](#1-æ¶æ„æ¦‚è§ˆ)
- [2. æŠ€æœ¯æ ˆ](#2-æŠ€æœ¯æ ˆ)
- [3. é¡¹ç›®ç»“æ„](#3-é¡¹ç›®ç»“æ„)
- [4. æ ¸å¿ƒæ¶æ„](#4-æ ¸å¿ƒæ¶æ„)
- [5. æ•°æ®æµ](#5-æ•°æ®æµ)
- [6. æ¨¡å—è®¾è®¡](#6-æ¨¡å—è®¾è®¡)
- [7. çŠ¶æ€ç®¡ç†](#7-çŠ¶æ€ç®¡ç†)
- [8. è·¯ç”±ç³»ç»Ÿ](#8-è·¯ç”±ç³»ç»Ÿ)
- [9. è®¤è¯ç³»ç»Ÿ](#9-è®¤è¯ç³»ç»Ÿ)
- [10. ç»„ä»¶æ¶æ„](#10-ç»„ä»¶æ¶æ„)
- [11. æ•°æ®åº“è®¾è®¡](#11-æ•°æ®åº“è®¾è®¡)
- [12. API é›†æˆ](#12-api-é›†æˆ)
- [13. æ€§èƒ½ä¼˜åŒ–](#13-æ€§èƒ½ä¼˜åŒ–)
- [14. å®‰å…¨æ€§](#14-å®‰å…¨æ€§)
- [15. æœªæ¥è§„åˆ’](#15-æœªæ¥è§„åˆ’)

---

## 1. æ¶æ„æ¦‚è§ˆ

### 1.1 æ•´ä½“æ¶æ„

Legal Workspace v3 é‡‡ç”¨ **å‰åç«¯åˆ†ç¦»** çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æ¶æ„ï¼ŒåŸºäº Vue 3 CDN ç‰ˆæœ¬æ„å»ºï¼Œä½¿ç”¨ Supabase ä½œä¸º BaaSï¼ˆBackend as a Serviceï¼‰æä¾›è®¤è¯å’Œæ•°æ®å­˜å‚¨æœåŠ¡ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·ç•Œé¢å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ æ¡ˆä»¶ç®¡ç†  â”‚  â”‚ æ³•å¾‹æ£€ç´¢  â”‚  â”‚ æ–‡ä¹¦ç”Ÿæˆ  â”‚  â”‚ ç”¨æˆ·ä¸­å¿ƒ  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        åº”ç”¨é€»è¾‘å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ è·¯ç”±ç®¡ç†  â”‚  â”‚ çŠ¶æ€ç®¡ç†  â”‚  â”‚ ç»„ä»¶ç³»ç»Ÿ  â”‚  â”‚ æœåŠ¡å±‚    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ•°æ®æœåŠ¡å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Supabase â”‚  â”‚ é€šä¹‰æ³•ç¿  â”‚  â”‚ æœ¬åœ°å­˜å‚¨  â”‚  â”‚ æ–‡ä»¶ç³»ç»Ÿ  â”‚    â”‚
â”‚  â”‚  è®¤è¯/DB â”‚  â”‚   API    â”‚  â”‚LocalStorageâ”‚ â”‚  ä¸Šä¼     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 è®¾è®¡åŸåˆ™

1. **æ¨¡å—åŒ–è®¾è®¡** - åŠŸèƒ½æ¨¡å—ç‹¬ç«‹ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
2. **ç»„ä»¶å¤ç”¨** - é€šç”¨ç»„ä»¶æŠ½å–ï¼Œå‡å°‘ä»£ç é‡å¤
3. **æ¸è¿›å¢å¼º** - åŸºç¡€åŠŸèƒ½ä¼˜å…ˆï¼Œé«˜çº§åŠŸèƒ½æ¨¡å—åŒ–
4. **ç”¨æˆ·ä½“éªŒ** - å“åº”å¼è®¾è®¡ï¼Œæµç•…äº¤äº’
5. **å®‰å…¨ç¬¬ä¸€** - è®¤è¯æˆæƒï¼Œæ•°æ®åŠ å¯†

---

## 2. æŠ€æœ¯æ ˆ

### 2.1 å‰ç«¯æŠ€æœ¯

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | å¼•å…¥æ–¹å¼ |
|------|------|------|----------|
| **Vue 3** | 3.4.21 | å‰ç«¯æ¡†æ¶ | npm |
| **Vite** | 5.4.21 | æ„å»ºå·¥å…· | npm |
| **D3.js** | 7.8.5 | æ•°æ®å¯è§†åŒ– | npm |
| **Sass** | æœ€æ–° | CSS é¢„å¤„ç†å™¨ | npm |
| **Font Awesome** | v6 | å›¾æ ‡åº“ | CDN |

### 2.2 åç«¯æœåŠ¡

| æœåŠ¡ | ç”¨é€” | è¯´æ˜ |
|------|------|------|
| **Supabase** | ç”¨æˆ·è®¤è¯ã€æ•°æ®åº“ | PostgreSQL + Auth |
| **é€šä¹‰æ³•ç¿ API** | æ³•å¾‹æ£€ç´¢ | æ¡ˆä¾‹ã€æ³•è§„æ£€ç´¢ |
| **æœ¬åœ°å­˜å‚¨** | ä¸´æ—¶æ•°æ® | LocalStorage |

### 2.3 å¼€å‘å·¥å…·

#### æ„å»ºä¸å¼€å‘
- **Vite 5.4.21** - å¼€å‘æœåŠ¡å™¨ å’Œç”Ÿäº§æ„å»º
- **npm** - åŒ…ç®¡ç†å’Œè„šæœ¬è¿è¡Œ

#### ä»£ç è´¨é‡
- **ESLint 8.56.0** - JavaScript/Vue ä»£ç è§„èŒƒæ£€æŸ¥
- **Prettier 3.2.4** - ä»£ç æ ¼å¼åŒ–
- **Husky 9.1.7** - Git Hooks ç®¡ç†
- **lint-staged** - æäº¤å‰è‡ªåŠ¨æ£€æŸ¥å’Œä¿®å¤

#### æµ‹è¯•æ¡†æ¶
- **Vitest** - å•å…ƒæµ‹è¯•æ¡†æ¶
- **@vue/test-utils** - Vue ç»„ä»¶æµ‹è¯•
- **happy-dom** - æµ‹è¯•ç¯å¢ƒ

#### CSS å¤„ç†
- **Sass (SCSS)** - CSS é¢„å¤„ç†å™¨
- **PostCSS + Autoprefixer** - è‡ªåŠ¨æµè§ˆå™¨å‰ç¼€

#### ç‰ˆæœ¬æ§åˆ¶ä¸éƒ¨ç½²
- **Git** - ç‰ˆæœ¬æ§åˆ¶
- **GitHub Pages** - åœ¨çº¿éƒ¨ç½²

### 2.4 å‰ç«¯è„šæ‰‹æ¶

é¡¹ç›®é‡‡ç”¨ **Vite + Vue 3** ç°ä»£åŒ–å·¥ç¨‹æ¶æ„ã€‚

#### 2.4.1 å¼€å‘å‘½ä»¤

```bash
# å¼€å‘ç¯å¢ƒï¼ˆçƒ­é‡è½½ï¼‰
npm run dev

# ç”Ÿäº§æ„å»º
npm run build

# é¢„è§ˆç”Ÿäº§æ„å»º
npm run preview

# ä»£ç æ£€æŸ¥å’Œä¿®å¤
npm run lint

# è¿è¡Œæµ‹è¯•
npm run test
npm run test:ui        # å¯è§†åŒ–æµ‹è¯•ç•Œé¢
npm run test:coverage  # ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
```

#### 2.4.2 ç›®å½•è§„èŒƒ
- **è§†å›¾å±‚ (`views/`)**: Vue SFC ç»„ä»¶å’Œ JS æ–‡ä»¶
- **ç»„ä»¶å±‚ (`components/`)**: é€šç”¨ UI ç»„ä»¶ï¼ˆSFCï¼‰
- **é…ç½®å±‚ (`config/`)**: ç¯å¢ƒé…ç½®ä¸å¸¸é‡
- **æ ·å¼å±‚ (`styles/`)**: SCSS æ¨¡å—åŒ–æ ·å¼
- **æµ‹è¯•å±‚ (`__tests__/`)**: å•å…ƒæµ‹è¯•æ–‡ä»¶

---

## 3. é¡¹ç›®ç»“æ„

### 3.1 ç›®å½•ç»“æ„

```
legal-workspace-vue/
â”œâ”€â”€ index.html                    # åº”ç”¨å…¥å£
â”œâ”€â”€ check-syntax.js               # è¯­æ³•æ£€æŸ¥å·¥å…·
â”‚
â”œâ”€â”€ assets/                       # é™æ€èµ„æº
â”‚   â””â”€â”€ styles/
â”‚       â”œâ”€â”€ main.css              # ä¸»æ ·å¼æ–‡ä»¶
â”‚       â”œâ”€â”€ brand.css             # å“ç‰Œæ ·å¼
â”‚       â””â”€â”€ evidence.css          # è¯æ®æ¨¡å—æ ·å¼
â”‚
â”œâ”€â”€ src/                          # æºä»£ç 
â”‚   â”œâ”€â”€ main.js                   # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ router.js                 # è·¯ç”±é…ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ config/                   # é…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ supabase.js           # Supabase é…ç½®ä¸æœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ store/                    # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ authStore.js          # è®¤è¯çŠ¶æ€
â”‚   â”‚
â”‚   â”œâ”€â”€ components/               # ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ layout/               # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ AppLayout.js      # ä¸»å¸ƒå±€
â”‚   â”‚   â”‚   â””â”€â”€ Sidebar.vue       # ä¾§è¾¹æ ï¼ˆSFCï¼‰
â”‚   â”‚   â””â”€â”€ HistoryModal.vue      # å†å²è®°å½•æ¨¡æ€æ¡†ï¼ˆSFCï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ styles/                   # SCSS æ ·å¼
â”‚   â”‚   â”œâ”€â”€ _variables.scss       # è®¾è®¡ç³»ç»Ÿå˜é‡
â”‚   â”‚   â”œâ”€â”€ _mixins.scss          # Mixins å·¥å…·
â”‚   â”‚   â”œâ”€â”€ main.scss             # ä¸»å…¥å£
â”‚   â”‚   â”œâ”€â”€ base/                 # åŸºç¡€æ ·å¼
â”‚   â”‚   â””â”€â”€ components/           # ç»„ä»¶æ ·å¼
â”‚   â”‚
â”‚   â””â”€â”€ views/                    # é¡µé¢è§†å›¾
â”‚       â”œâ”€â”€ Login.vue             # ç™»å½•ï¼ˆSFCï¼‰
â”‚       â”œâ”€â”€ Register.vue          # æ³¨å†Œï¼ˆSFCï¼‰
â”‚       â”œâ”€â”€ ForgotPassword.vue    # å¿˜è®°å¯†ç ï¼ˆSFCï¼‰
â”‚       â”œâ”€â”€ CaseList.vue          # æ¡ˆä»¶åˆ—è¡¨ï¼ˆSFCï¼‰
â”‚       â”œâ”€â”€ CaseForm.vue          # æ¡ˆä»¶è¡¨å•ï¼ˆSFCï¼‰
â”‚       â”œâ”€â”€ CaseDetail.js         # æ¡ˆä»¶è¯¦æƒ…
â”‚       â”œâ”€â”€ EvidenceUpload.js     # è¯æ®ä¸Šä¼ 
â”‚       â”‚
â”‚       â”œâ”€â”€ LegalResearch.js      # æ³•å¾‹æ£€ç´¢
â”‚       â”œâ”€â”€ CaseSearchResults.js  # æ¡ˆä¾‹æ£€ç´¢ç»“æœ
â”‚       â”œâ”€â”€ CaseDetailView.js     # æ¡ˆä¾‹è¯¦æƒ…
â”‚       â”œâ”€â”€ RegulationSearchResults.js # æ³•è§„æ£€ç´¢ç»“æœ
â”‚       â”‚
â”‚       â”œâ”€â”€ ContractReview.js     # åˆåŒå®¡æŸ¥
â”‚       â”œâ”€â”€ ContractReviewResult.js # åˆåŒå®¡æŸ¥ç»“æœ
â”‚       â”œâ”€â”€ DocGenerate.js        # æ–‡ä¹¦ç”Ÿæˆ
â”‚       â”‚
â”‚       â”œâ”€â”€ UserProfile.js        # ä¸ªäººèµ„æ–™
â”‚       â”œâ”€â”€ Settings.js           # ç³»ç»Ÿè®¾ç½®
â”‚       â”œâ”€â”€ ProductFeedback.js    # äº§å“åé¦ˆ
â”‚       â”‚
â”‚       â”œâ”€â”€ __tests__/            # æµ‹è¯•æ–‡ä»¶
â”‚       â”‚   â””â”€â”€ Login.test.js     # ç™»å½•ç»„ä»¶æµ‹è¯•
â”‚       â”‚
â”‚       â””â”€â”€ refactor/             # é‡æ„çš„é«˜çº§åŠŸèƒ½æ¨¡å—
â”‚           â”œâ”€â”€ AIAnalysis.js     # AI æ™ºèƒ½åˆ†æ
â”‚           â”œâ”€â”€ AIAssistant.js    # AI å¯¹è¯åŠ©æ‰‹
â”‚           â”œâ”€â”€ RelationshipGraph.js # å…³ç³»å›¾è°±
â”‚           â”œâ”€â”€ EvidenceTimeline.js  # è¯æ®æ—¶é—´è½´
â”‚           â””â”€â”€ QuoteGenerator.js    # æŠ¥ä»·ç”Ÿæˆå™¨
â”‚
â””â”€â”€ docs/                         # æ–‡æ¡£
    â”œâ”€â”€ PRD.md                    # äº§å“éœ€æ±‚æ–‡æ¡£
    â”œâ”€â”€ design-guidelines.md      # è®¾è®¡è§„èŒƒ
    â”œâ”€â”€ æ¶æ„è®¾è®¡æ–‡æ¡£.md            # æœ¬æ–‡æ¡£
    â”œâ”€â”€ api/                      # API æ–‡æ¡£
    â””â”€â”€ sql/                      # æ•°æ®åº“è„šæœ¬
```

### 3.2 æ–‡ä»¶å‘½åè§„èŒƒ

- **ç»„ä»¶æ–‡ä»¶**: PascalCase (å¦‚ `CaseList.js`)
- **é…ç½®æ–‡ä»¶**: camelCase (å¦‚ `supabase.js`)
- **æ ·å¼æ–‡ä»¶**: kebab-case (å¦‚ `main.css`)
- **æ–‡æ¡£æ–‡ä»¶**: ä¸­æ–‡æˆ–è‹±æ–‡æè¿°æ€§åç§°

---

## 4. æ ¸å¿ƒæ¶æ„

### 4.1 åº”ç”¨å…¥å£ (main.js)

```javascript
// æ ¸å¿ƒæµç¨‹
1. å¯¼å…¥ä¾èµ– (router, authService, components)
2. åˆå§‹åŒ–è®¤è¯çŠ¶æ€
   - è·å–å½“å‰ä¼šè¯
   - åŠ è½½ç”¨æˆ·èµ„æ–™ (å¤´åƒã€èŒä½)
   - ç›‘å¬è®¤è¯çŠ¶æ€å˜åŒ–
3. åˆ›å»º Vue åº”ç”¨å®ä¾‹
4. æ³¨å†Œå…¨å±€ç»„ä»¶
5. æŒ‚è½½åº”ç”¨åˆ° #app
```

**å…³é”®ç‰¹æ€§**:
- è®¤è¯çŠ¶æ€è‡ªåŠ¨åŒæ­¥
- è·¯ç”±å®ˆå« (æœªç™»å½•é‡å®šå‘)
- åŠ¨æ€ç»„ä»¶åŠ è½½
- å…¨å±€é”™è¯¯å¤„ç†

### 4.2 è·¯ç”±ç³»ç»Ÿ (router.js)

```javascript
// ç®€å•çš„ Hash è·¯ç”±å®ç°
const routes = {
    '/': 'CaseList',
    '/detail': 'CaseDetail',
    '/login': 'Login',
    // ...
};

const router = {
    currentRoute: window.location.hash.slice(1) || '/',
    push(path) { /* å¯¼èˆªé€»è¾‘ */ },
    back() { /* è¿”å›é€»è¾‘ */ }
};
```

**ç‰¹ç‚¹**:
- åŸºäº Hash è·¯ç”±
- æ”¯æŒå‰è¿›/åé€€
- è·¯ç”±å®ˆå«é›†æˆ
- ç®€å•è½»é‡

---

## 5. æ•°æ®æµ

### 5.1 æ•°æ®æµå‘å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·æ“ä½œ  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vue ç»„ä»¶  â”‚ â† å“åº”å¼æ•°æ®ç»‘å®š
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çŠ¶æ€ç®¡ç†  â”‚ (authStore, ç»„ä»¶å†…éƒ¨çŠ¶æ€)
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœåŠ¡å±‚    â”‚ (authService, filterService, brandService)
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ•°æ®æº    â”‚ (Supabase, API, LocalStorage)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 è®¤è¯æ•°æ®æµ

```
ç”¨æˆ·ç™»å½•
  â†“
authService.signIn(email, password)
  â†“
Supabase Auth API
  â†“
è¿”å› session
  â†“
authStore.setAuth(session)
  â†“
è§¦å‘ onAuthStateChange
  â†“
åŠ è½½ç”¨æˆ·èµ„æ–™ (loadUserProfile)
  â†“
æ›´æ–° UI (å¤´åƒã€ç”¨æˆ·åç­‰)
```

---

## 6. æ¨¡å—è®¾è®¡

### 6.1 æ¡ˆä»¶ç®¡ç†æ¨¡å—

**æ ¸å¿ƒç»„ä»¶**:
- `CaseList.js` - æ¡ˆä»¶åˆ—è¡¨
- `CaseDetail.js` - æ¡ˆä»¶è¯¦æƒ…
- `CaseForm.js` - æ¡ˆä»¶è¡¨å•
- `EvidenceUpload.js` - è¯æ®ä¸Šä¼ 

**åŠŸèƒ½**:
- æ¡ˆä»¶ CRUD æ“ä½œ
- çŠ¶æ€æµè½¬ (è‰ç¨¿ â†’ è¿›è¡Œä¸­ â†’ å·²ç»“æ¡ˆ)
- å¤šç»´åº¦ç­›é€‰å’Œæœç´¢
- è¯æ®ç®¡ç†

**æ•°æ®è¡¨**:
- `cases` - æ¡ˆä»¶ä¸»è¡¨
- `evidence` - è¯æ®è¡¨ (è®¡åˆ’ä¸­)

### 6.2 æ³•å¾‹æ£€ç´¢æ¨¡å—

**æ ¸å¿ƒç»„ä»¶**:
- `LegalResearch.js` - æ£€ç´¢å…¥å£
- `CaseSearchResults.js` - æ¡ˆä¾‹ç»“æœ
- `RegulationSearchResults.js` - æ³•è§„ç»“æœ
- `CaseDetailView.js` - æ¡ˆä¾‹è¯¦æƒ…

**åŠŸèƒ½**:
- æ¡ˆä¾‹æ£€ç´¢ (é€šä¹‰æ³•ç¿ API)
- æ³•è§„æ£€ç´¢ (é€šä¹‰æ³•ç¿ API)
- é«˜çº§ç­›é€‰
- å†å²è®°å½•

**API é›†æˆ**:
- é€šä¹‰æ³•ç¿æ¡ˆä¾‹æ£€ç´¢ API
- é€šä¹‰æ³•ç¿æ³•è§„æ£€ç´¢ API

### 6.3 é«˜çº§åŠŸèƒ½æ¨¡å— (refactor/)

#### 6.3.1 AI æ™ºèƒ½åˆ†æ (AIAnalysis.js)

**åŠŸèƒ½**:
- èƒœè¯‰ç‡é¢„æµ‹
- é£é™©ç‚¹è¯†åˆ«
- è¯‰è®¼ç­–ç•¥å»ºè®®
- å¯è§†åŒ–å±•ç¤º

**æ•°æ®æ¥æº**:
- æ¡ˆä»¶åŸºç¡€ä¿¡æ¯
- è¯æ®ææ–™
- å†å²æ¡ˆä¾‹æ•°æ®

#### 6.3.2 AI å¯¹è¯åŠ©æ‰‹ (AIAssistant.js)

**åŠŸèƒ½**:
- åŸºäºæ¡ˆä»¶çš„æ™ºèƒ½é—®ç­”
- å¿«æ·å»ºè®®
- å¯¹è¯å†å²è®°å½•

**æŠ€æœ¯**:
- å¤§è¯­è¨€æ¨¡å‹ API (è®¡åˆ’ä¸­)
- ä¸Šä¸‹æ–‡ç®¡ç†

#### 6.3.3 å…³ç³»æ´å¯Ÿ (RelationshipGraph.js)

**åŠŸèƒ½**:
- äººç‰©/å…¬å¸å…³ç³»ç½‘ç»œå¯è§†åŒ–
- èµ„é‡‘å¾€æ¥å¯è§†åŒ–
- äº¤äº’å¼èŠ‚ç‚¹æ“ä½œ

**æŠ€æœ¯**:
- D3.js åŠ›å¯¼å‘å›¾
- æ‹–æ‹½ã€ç¼©æ”¾äº¤äº’

#### 6.3.4 è¯æ®æ—¶é—´è½´ (EvidenceTimeline.js)

**åŠŸèƒ½**:
- è¯æ®äº‹ä»¶æ—¶é—´çº¿å±•ç¤º
- æ—¶é—´è½´ç¼–è¾‘
- å¯¼å‡ºåŠŸèƒ½

**æ•°æ®ç»“æ„**:
```javascript
{
  date: '2024-01-01',
  title: 'ç­¾è®¢åˆåŒ',
  description: '...',
  evidenceId: 'xxx'
}
```

#### 6.3.5 æŠ¥ä»·ç”Ÿæˆå™¨ (QuoteGenerator.js)

**åŠŸèƒ½**:
- æ³•å¾‹æœåŠ¡æŠ¥ä»·ä¹¦ç”Ÿæˆ
- è‡ªåŠ¨å¡«å……æ¡ˆä»¶ä¿¡æ¯
- PDF å¯¼å‡º

---

## 7. çŠ¶æ€ç®¡ç†

### 7.1 è®¤è¯çŠ¶æ€ (authStore.js)

```javascript
const authStore = Vue.reactive({
    user: null,           // å½“å‰ç”¨æˆ·
    session: null,        // ä¼šè¯ä¿¡æ¯
    loading: true,        // åŠ è½½çŠ¶æ€
    avatarUrl: null,      // ç”¨æˆ·å¤´åƒ
    title: null,          // ç”¨æˆ·èŒä½
    
    // æ–¹æ³•
    setAuth(session),
    clearAuth(),
    setAvatarUrl(url),
    setTitle(title),
    isAuthenticated()
});
```

**ç‰¹ç‚¹**:
- Vue 3 å“åº”å¼å¯¹è±¡
- å…¨å±€å…±äº«
- è‡ªåŠ¨æŒä¹…åŒ– (é€šè¿‡ Supabase)

### 7.2 ç»„ä»¶å†…éƒ¨çŠ¶æ€

æ¯ä¸ªç»„ä»¶ç»´æŠ¤è‡ªå·±çš„å±€éƒ¨çŠ¶æ€:
```javascript
data() {
    return {
        cases: [],        // æ¡ˆä»¶åˆ—è¡¨
        loading: false,   // åŠ è½½çŠ¶æ€
        filters: {},      // ç­›é€‰æ¡ä»¶
        // ...
    }
}
```

---

## 8. è·¯ç”±ç³»ç»Ÿ

### 8.1 è·¯ç”±è¡¨

| è·¯ç”±è·¯å¾„ | ç»„ä»¶ | è¯´æ˜ | è®¤è¯è¦æ±‚ |
|---------|------|------|---------|
| `/` | CaseList | æ¡ˆä»¶åˆ—è¡¨ | âœ… |
| `/detail` | CaseDetail | æ¡ˆä»¶è¯¦æƒ… | âœ… |
| `/create` | CaseForm | æ–°å»ºæ¡ˆä»¶ | âœ… |
| `/edit` | CaseForm | ç¼–è¾‘æ¡ˆä»¶ | âœ… |
| `/evidence-upload` | EvidenceUpload | è¯æ®ä¸Šä¼  | âœ… |
| `/legal-research` | LegalResearch | æ³•å¾‹æ£€ç´¢ | âœ… |
| `/case-search-results` | CaseSearchResults | æ¡ˆä¾‹ç»“æœ | âœ… |
| `/regulation-search-results` | RegulationSearchResults | æ³•è§„ç»“æœ | âœ… |
| `/contract-review` | ContractReview | åˆåŒå®¡æŸ¥ | âœ… |
| `/doc-generate` | DocGenerate | æ–‡ä¹¦ç”Ÿæˆ | âœ… |
| `/profile` | UserProfile | ä¸ªäººèµ„æ–™ | âœ… |
| `/settings` | Settings | ç³»ç»Ÿè®¾ç½® | âœ… |
| `/feedback` | ProductFeedback | äº§å“åé¦ˆ | âœ… |
| `/login` | Login | ç™»å½• | âŒ |
| `/register` | Register | æ³¨å†Œ | âŒ |
| `/forgot-password` | ForgotPassword | å¿˜è®°å¯†ç  | âŒ |

### 8.2 è·¯ç”±å®ˆå«

```javascript
// åœ¨ main.js ä¸­å®ç°
computed: {
    requiresAuth() {
        const publicRoutes = ['/login', '/register', '/forgot-password'];
        return !publicRoutes.includes(this.currentRoute);
    }
},
methods: {
    onRouteChange() {
        if (this.requiresAuth && !authStore.isAuthenticated()) {
            router.push('/login');
        }
    }
}
```

---

## 9. è®¤è¯ç³»ç»Ÿ

### 9.1 è®¤è¯æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è®¿é—®    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ£€æŸ¥ä¼šè¯     â”‚ â† Supabase getSession()
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
  â”‚ å·²ç™»å½•ï¼Ÿ â”‚
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
   Yes â”‚ No
       â”‚    â””â”€â”€â†’ é‡å®šå‘åˆ° /login
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŠ è½½ç”¨æˆ·èµ„æ–™ â”‚ â† profiles è¡¨
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ˜¾ç¤ºåº”ç”¨ç•Œé¢ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 è®¤è¯æœåŠ¡ (authService)

```javascript
export const authService = {
    signUp(email, password, metadata),    // æ³¨å†Œ
    signIn(email, password),              // ç™»å½•
    signOut(),                            // ç™»å‡º
    getCurrentUser(),                     // è·å–å½“å‰ç”¨æˆ·
    getSession(),                         // è·å–ä¼šè¯
    onAuthStateChange(callback),          // ç›‘å¬çŠ¶æ€å˜åŒ–
    resetPassword(email),                 // é‡ç½®å¯†ç 
    updateUser(updates)                   // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
};
```

### 9.3 ä¼šè¯ç®¡ç†

- **ä¼šè¯å­˜å‚¨**: Supabase è‡ªåŠ¨ç®¡ç† (localStorage)
- **ä¼šè¯åˆ·æ–°**: è‡ªåŠ¨åˆ·æ–° token
- **ä¼šè¯è¿‡æœŸ**: è‡ªåŠ¨é‡å®šå‘åˆ°ç™»å½•é¡µ

---

## 10. ç»„ä»¶æ¶æ„

### 10.1 ç»„ä»¶åˆ†ç±»

#### å¸ƒå±€ç»„ä»¶ (Layout Components)
- `AppLayout.js` - ä¸»å¸ƒå±€å®¹å™¨
- `Sidebar.js` - ä¾§è¾¹æ å¯¼èˆª

#### é¡µé¢ç»„ä»¶ (Page Components)
- æ¡ˆä»¶ç®¡ç†: `CaseList`, `CaseDetail`, `CaseForm`
- æ³•å¾‹æ£€ç´¢: `LegalResearch`, `CaseSearchResults`
- ç”¨æˆ·ä¸­å¿ƒ: `UserProfile`, `Settings`

#### åŠŸèƒ½ç»„ä»¶ (Feature Components)
- `HistoryModal.js` - å†å²è®°å½•æ¨¡æ€æ¡†
- `refactor/` ä¸‹çš„é«˜çº§åŠŸèƒ½ç»„ä»¶

### 10.2 ç»„ä»¶é€šä¿¡

```
çˆ¶ç»„ä»¶
  â†“ props
å­ç»„ä»¶
  â†‘ emit events
çˆ¶ç»„ä»¶
```

**ç¤ºä¾‹**:
```javascript
// çˆ¶ç»„ä»¶ä¼ é€’æ•°æ®
<HistoryModal :items="historyItems" @close="handleClose" />

// å­ç»„ä»¶æ¥æ”¶å’Œè§¦å‘
props: ['items'],
methods: {
    close() {
        this.$emit('close');
    }
}
```

### 10.3 ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ

```javascript
export default {
    data() { /* åˆå§‹åŒ–æ•°æ® */ },
    created() { /* ç»„ä»¶åˆ›å»ºå */ },
    mounted() { /* DOM æŒ‚è½½å */ },
    beforeUnmount() { /* å¸è½½å‰æ¸…ç† */ }
}
```

---

## 11. æ•°æ®åº“è®¾è®¡

### 11.1 Supabase æ•°æ®è¡¨

#### cases (æ¡ˆä»¶è¡¨)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | uuid | ä¸»é”® |
| user_id | uuid | ç”¨æˆ· ID (å¤–é”®) |
| case_number | text | æ¡ˆä»¶ç¼–å· |
| title | text | æ¡ˆä»¶æ ‡é¢˜ |
| status | text | çŠ¶æ€ (draft/active/closed) |
| stage | text | é˜¶æ®µ (å’¨è¯¢/ç«‹æ¡ˆ/ä¸€å®¡ç­‰) |
| case_type | text | æ¡ˆä»¶ç±»å‹ |
| description | text | æ¡ˆæƒ…æè¿° |
| parties | jsonb | å½“äº‹äººä¿¡æ¯ |
| financial | jsonb | è´¢åŠ¡ä¿¡æ¯ |
| contact | jsonb | è”ç»œäººä¿¡æ¯ |
| created_at | timestamp | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | æ›´æ–°æ—¶é—´ |

#### profiles (ç”¨æˆ·èµ„æ–™è¡¨)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | uuid | ä¸»é”® (å…³è” auth.users) |
| email | text | é‚®ç®± |
| full_name | text | å§“å |
| avatar_url | text | å¤´åƒ URL |
| title | text | èŒä½ |
| phone | text | ç”µè¯ |
| created_at | timestamp | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | æ›´æ–°æ—¶é—´ |

#### search_filter_options (ç­›é€‰é¡¹è¡¨)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | uuid | ä¸»é”® |
| category | text | åˆ†ç±» (case/regulation) |
| filter_key | text | ç­›é€‰é”® |
| label | text | æ˜¾ç¤ºæ ‡ç­¾ |
| value | text | å€¼ |
| display_order | int | æ˜¾ç¤ºé¡ºåº |
| is_active | boolean | æ˜¯å¦å¯ç”¨ |

#### brand_settings (å“ç‰Œè®¾ç½®è¡¨)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | uuid | ä¸»é”® |
| setting_key | text | è®¾ç½®é”® |
| setting_value | text | è®¾ç½®å€¼ |
| setting_type | text | ç±»å‹ |

#### product_feedback (äº§å“åé¦ˆè¡¨)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | uuid | ä¸»é”® |
| user_id | uuid | ç”¨æˆ· ID |
| category | text | åˆ†ç±» |
| title | text | æ ‡é¢˜ |
| description | text | æè¿° |
| priority | text | ä¼˜å…ˆçº§ |
| status | text | çŠ¶æ€ |
| created_at | timestamp | åˆ›å»ºæ—¶é—´ |

### 11.2 æ•°æ®åº“å…³ç³»

```
auth.users (Supabase Auth)
    â†“ 1:1
profiles
    â†“ 1:N
cases
    â†“ 1:N
evidence (è®¡åˆ’ä¸­)

search_filter_options (ç‹¬ç«‹è¡¨)
brand_settings (ç‹¬ç«‹è¡¨)
product_feedback â†’ user_id â†’ auth.users
```

---

## 12. API é›†æˆ

### 12.1 é€šä¹‰æ³•ç¿ API

#### æ¡ˆä¾‹æ£€ç´¢ API

**ç«¯ç‚¹**: `POST /api/case-search`

**è¯·æ±‚å‚æ•°**:
```javascript
{
  query: "åˆåŒçº çº·",
  filters: {
    court: "æœ€é«˜äººæ°‘æ³•é™¢",
    caseType: "æ°‘äº‹æ¡ˆä»¶",
    year: "2023"
  },
  page: 1,
  pageSize: 20
}
```

**å“åº”**:
```javascript
{
  total: 100,
  cases: [
    {
      id: "xxx",
      title: "æ¡ˆä»¶æ ‡é¢˜",
      court: "æ³•é™¢",
      date: "2023-01-01",
      summary: "æ‘˜è¦",
      // ...
    }
  ]
}
```

#### æ³•è§„æ£€ç´¢ API

**ç«¯ç‚¹**: `POST /api/regulation-search`

**è¯·æ±‚å‚æ•°**:
```javascript
{
  query: "åˆåŒæ³•",
  filters: {
    category: "æ³•å¾‹",
    effectStatus: "æœ‰æ•ˆ"
  },
  page: 1,
  pageSize: 20
}
```

### 12.2 Supabase API

é€šè¿‡ `supabase.js` å°è£…çš„æœåŠ¡:
- `authService` - è®¤è¯æœåŠ¡
- `filterService` - ç­›é€‰é¡¹æœåŠ¡
- `brandService` - å“ç‰Œè®¾ç½®æœåŠ¡

**ç¤ºä¾‹**:
```javascript
// è·å–æ¡ˆä»¶åˆ—è¡¨
const { data, error } = await supabase
    .from('cases')
    .select('*')
    .eq('user_id', userId)
    .order('created_at', { ascending: false });
```

---

## 13. æ€§èƒ½ä¼˜åŒ–

### 13.1 å·²å®ç°çš„ä¼˜åŒ–

1. **Vite æ„å»ºä¼˜åŒ–**
   - æé€Ÿå†·å¯åŠ¨
   - é—ªç”µèˆ¬çš„ HMR (çƒ­æ¨¡å—æ›¿æ¢)
   - ç”Ÿäº§ç¯å¢ƒ Tree-shaking
   - ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½

2. **èµ„æºä¼˜åŒ–**
   - npm åŒ…ç®¡ç†ï¼Œç‰ˆæœ¬é”å®š
   - èµ„æºå“ˆå¸Œç¼“å­˜
   - Autoprefixer è‡ªåŠ¨æµè§ˆå™¨å…¼å®¹

3. **åº”ç”¨ä¼˜åŒ–**
   - æŒ‰éœ€åŠ è½½ - ç»„ä»¶åŠ¨æ€å¯¼å…¥
   - ç¼“å­˜æœºåˆ¶ - å“ç‰Œè®¾ç½® 5 åˆ†é’Ÿç¼“å­˜
   - å“åº”å¼æ•°æ® - Vue 3 å“åº”å¼ç³»ç»Ÿ

### 13.2 è®¡åˆ’ä¸­çš„ä¼˜åŒ–

1. **å›¾ç‰‡æ‡’åŠ è½½** - è¯æ®å›¾ç‰‡æ‡’åŠ è½½
2. **è™šæ‹Ÿæ»šåŠ¨** - é•¿åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨
3. **Service Worker** - ç¦»çº¿ç¼“å­˜

---

## 14. å®‰å…¨æ€§

### 14.1 è®¤è¯å®‰å…¨

- **Supabase Auth** - è¡Œä¸šæ ‡å‡†çš„è®¤è¯ç³»ç»Ÿ
- **JWT Token** - å®‰å…¨çš„ä¼šè¯ç®¡ç†
- **å¯†ç åŠ å¯†** - bcrypt åŠ å¯†å­˜å‚¨
- **ä¼šè¯è¿‡æœŸ** - è‡ªåŠ¨è¿‡æœŸå’Œåˆ·æ–°

### 14.2 æ•°æ®å®‰å…¨

- **Row Level Security (RLS)** - Supabase è¡Œçº§å®‰å…¨ç­–ç•¥
- **ç”¨æˆ·éš”ç¦»** - æ¯ä¸ªç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
- **è¾“å…¥éªŒè¯** - å‰ç«¯è¡¨å•éªŒè¯
- **XSS é˜²æŠ¤** - Vue è‡ªåŠ¨è½¬ä¹‰

### 14.3 API å®‰å…¨

- **CORS é…ç½®** - è·¨åŸŸè¯·æ±‚é™åˆ¶
- **Rate Limiting** - API è¯·æ±‚é¢‘ç‡é™åˆ¶ (è®¡åˆ’ä¸­)
- **API Key ç®¡ç†** - ç¯å¢ƒå˜é‡å­˜å‚¨

---

## 15. æœªæ¥è§„åˆ’

### 15.1 v3.4 è®¡åˆ’

- [ ] è¯æ®æ—¶é—´è½´ç¼–è¾‘å™¨
- [ ] æ–‡ä»¶é¢„è§ˆåŠŸèƒ½
- [ ] è·¯ç”±å®ˆå«å¢å¼º
- [ ] ç”¨æˆ·èµ„æ–™æ‰©å±•

### 15.2 v4.0 æ„¿æ™¯

- [ ] å›¢é˜Ÿåä½œåŠŸèƒ½
- [ ] æƒé™ç®¡ç†ç³»ç»Ÿ
- [ ] åç«¯ API æœåŠ¡
- [ ] æ•°æ®åˆ†æçœ‹æ¿
- [ ] ç§»åŠ¨ç«¯é€‚é…

### 15.3 æŠ€æœ¯æ¼”è¿›

- [ ] è¿ç§»åˆ° Vue 3 + Vite æ„å»º
- [ ] TypeScript é‡æ„
- [ ] å¾®å‰ç«¯æ¶æ„
- [ ] GraphQL API

---

## é™„å½•

### A. å¼€å‘è§„èŒƒ

å‚è€ƒæ–‡æ¡£:
- [å‰ç«¯å¼€å‘è§„èŒƒ](./å‰ç«¯å¼€å‘è§„èŒƒ.md)
- [è®¾è®¡è§„èŒƒ](./design-guidelines.md)

### B. API æ–‡æ¡£

å‚è€ƒæ–‡æ¡£:
- [é€šä¹‰æ³•ç¿-æ¡ˆä¾‹æ£€ç´¢APIå¯¹æ¥æ–‡æ¡£](./api/é€šä¹‰æ³•ç¿-æ¡ˆä¾‹æ£€ç´¢APIå¯¹æ¥æ–‡æ¡£.md)
- [é€šä¹‰æ³•ç¿-æ³•è§„æ£€ç´¢APIå¯¹æ¥æ–‡æ¡£](./api/é€šä¹‰æ³•ç¿-æ³•è§„æ£€ç´¢APIå¯¹æ¥æ–‡æ¡£.md)

### C. æ•°æ®åº“è„šæœ¬

å‚è€ƒç›®å½•: `./sql/`

---

**æ–‡æ¡£ç»´æŠ¤è€…**: Alpha&Leader Legal Tech  
**è”ç³»æ–¹å¼**: [GitHub Issues](https://github.com/690925339/legal-workspace-v3/issues)
